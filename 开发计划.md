### **第一阶段：基础环境搭建与核心表结构实现（1-2周）**
#### **目标**  
完成开发环境配置、数据库初始化及核心表结构部署，为后续功能开发提供基础支撑。

#### **任务清单**  
1. **环境搭建**  
   - 在Arch Linux中安装MariaDB（配置字符集、端口、权限）和Valkey（按`maxmemory 2gb`及`allkeys-lru`策略配置）。  
   - 搭建开发框架（如Java Spring Boot/Node.js等，根据技术栈选择），集成数据库驱动（MariaDB Connector）和Valkey客户端（如Jedis）。  

2. **数据库初始化**  
   - 执行`sql/`目录下所有表结构脚本（`sys_user.sql`、`account.sql`、`category.sql`等），创建10张核心表。  
   - 插入系统默认数据：  
     - 系统默认收支类别（参考初始化建议中的`category`插入语句）。  
     - 系统配置表（`sys_config`）基础参数（如默认预算提醒比例、会话过期时间等）。  

3. **基础工具类开发**  
   - 封装数据库连接池、事务管理工具。  
   - 集成数据脱敏工具（基于`hutool`的`DesensitizedUtil`，实现卡号、手机号等敏感信息脱敏）。  

#### **交付物**  
- 可运行的开发环境（含数据库、缓存服务）。  
- 完整的数据库表结构及初始数据。  
- 基础工具类代码（脱敏、数据库操作、缓存操作）。  


### **第二阶段：核心功能模块开发（3-4周）**  
#### **目标**  
实现用户管理、账户管理、分类记账等基础功能，确保核心业务流程跑通。

#### **任务清单**  
1. **用户管理模块**  
   - 实现用户注册（用户名唯一校验、密码BCrypt加密存储）、登录（Token生成与验证）、信息修改（昵称、密码）。  
   - 基于`sys_user`表，通过`user_id`实现数据隔离（所有查询、操作均携带用户ID）。  

2. **账户管理模块**  
   - 支持账户增删改查（名称、类型、卡号脱敏存储）、余额实时展示（关联`account`表和Valkey缓存`account:balance:{accountId}`）。  
   - 实现账户余额变动记录（`account_transaction`表），确保记账时自动更新余额（事务控制：记录+余额变动原子性）。  

3. **分类管理模块**  
   - 展示系统默认类别+用户自定义类别（`category`表，`user_id`区分），支持用户新增、编辑、删除自定义类别（类型限制为支出/收入）。  

4. **记账记录模块**  
   - 实现收支记录添加（关联账户、类别，存储`original_text`用户输入）、编辑、删除（同步更新`account_transaction`和账户余额）。  
   - 基于`idx_user_date`索引，实现按日期范围查询记录（支持天/周/月筛选）。  

#### **交付物**  
- 用户管理API（注册/登录/信息修改）。  
- 账户管理API（增删改查/余额查询）。  
- 分类管理API（查询/自定义类别）。  
- 记账记录API（添加/编辑/删除/查询）。  


### **第三阶段：预算控制与对话功能开发（2-3周）**  
#### **目标**  
实现预算设置、执行跟踪及对话上下文管理，支撑AI分析的数据基础。

#### **任务清单**  
1. **预算管理模块**  
   - 预算创建：支持用户按月度/季度/年度（`cycle_type`）设置总预算（`budget_main`），并拆分到具体类别（`budget_sub`，关联`category_id`）。  
   - 预算执行跟踪：  
     - 记账时自动更新`budget_execution`表（`used_amount`累加、`remaining_amount`计算、`progress_ratio`比例更新）。  
     - 超支判断（`is_overspent=1`）及提醒（基于`remind_ratio`，如达80%时触发）。  
   - 缓存预算执行进度（`budget:execution:{subId}`），提升查询效率。  

2. **对话上下文模块**  
   - 基于`conversation`表和Valkey缓存（`session:{sessionId}`），存储用户会话历史（`context_data`），设置过期时间（默认24小时）。  
   - 实现会话关联记账记录（`last_record_id`），支持上下文连贯交互（如“这笔钱是什么用途？”关联最近记录）。  

#### **交付物**  
- 预算管理API（创建/拆分/执行查询/提醒）。  
- 对话上下文API（创建/更新/查询/过期清理）。  


### **第四阶段：AI收支分析与优化建议功能开发（2-3周）**  
#### **目标**  
实现按多周期（周/月/季度/年）的收支统计、AI总结及专家级建议输出。

#### **任务清单**  
1. **数据统计模块**  
   - 按时间周期（周/月/季度/年）聚合数据：  
     - 收支总额、类别占比（基于`account_record`的`type`和`category_id`）。  
     - 预算执行情况（对比`budget_sub.amount`与`budget_execution.used_amount`）。  
   - 缓存统计结果（扩展Valkey键：`stats:week:{userId}:{yw}`、`stats:quarter:{userId}:{yq}`、`stats:year:{userId}:{y}`），减少重复计算。  

2. **AI分析集成**  
   - 封装统计数据为结构化输入（如JSON格式：`{"period":"2024-05","income":5000,"expense":{"餐饮":1500,"交通":500},"overspent":["购物"]}`）。  
   - 调用大语言模型（如GPT系列），提示词示例：  
     ```  
     以财务专家身份分析以下{周期}收支数据：总收入{X}元，总支出{Y}元，支出中{类别A}占比{Z}%，超支类别为{...}。请指出非必要支出（如高频小额消费、冲动消费），并给出具体优化建议（如减少外卖频率、合并会员订阅）。  
     ```  
   - 解析模型输出，格式化展示（自然语言报告+关键数据高亮）。  

#### **交付物**  
- 多周期收支统计API。  
- AI分析接口（输入统计数据，输出总结与建议）。  
- 前端展示组件（AI报告页面）。  


### **第五阶段：测试、优化与部署（2周）**  
#### **目标**  
确保系统稳定性、性能达标，完成生产环境部署。

#### **任务清单**  
1. **测试**  
   - 单元测试：核心模块（记账逻辑、预算计算、数据脱敏）。  
   - 集成测试：模块间交互（如记账→余额更新→预算执行联动）。  
   - 性能测试：高并发下记账接口响应时间（目标<100ms）、缓存命中率（目标>90%）。  

2. **优化**  
   - 针对慢查询优化索引（如`account_record`的`idx_user_date`扩展为复合索引）。  
   - 调整Valkey缓存策略（如高频统计数据延长过期时间）。  
   - 修复测试中发现的BUG（如数据一致性、权限控制漏洞）。  

3. **部署**  
   - 生产环境配置（Arch Linux服务器、MariaDB主从备份、Valkey集群）。  
   - 数据迁移脚本（开发环境→生产环境）。  
   - 监控系统搭建（数据库连接数、缓存使用率、接口响应时间）。  

#### **交付物**  
- 测试报告（含BUG清单及修复结果）。  
- 生产环境部署文档。  
- 监控面板（实时展示系统状态）。  


### **第六阶段：上线后维护与迭代（持续）**  
- 收集用户反馈，优化AI建议准确性（调整提示词、增加行业知识库）。  
- 扩展功能（如多用户家庭账户、导出收支报表）。  
- 定期更新依赖库（安全补丁）、优化性能（分表策略：如`account_record`按用户ID分表）。  


**总计开发周期**：约12-17周（可根据团队规模调整，单人开发可延长至16-20周）。